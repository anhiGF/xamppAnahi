<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comunicación Directa - ITS Jerez</title>
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
    }
    .chat-container {
      display: flex;
      height: 80vh;
      margin-top: 20px;
    }
    .contact-list {
      width: 25%;
      border-right: 1px solid #ddd;
      overflow-y: auto;
    }
    .contact-item {
      padding: 10px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .contact-item:hover, .contact-item.active {
      background-color: #e9ecef;
    }
    .chat-window {
      width: 75%;
      display: flex;
      flex-direction: column;
      padding: 10px;
    }
    .messages {
      flex-grow: 1;
      overflow-y: auto;
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }
    .message-input {
      display: flex;
      align-items: center;
      padding: 10px;
    }
    .message-input input {
      flex-grow: 1;
      margin-right: 10px;
    }
    .message {
      padding: 8px;
      margin-bottom: 5px;
      border-radius: 10px;
      max-width: 70%;
    }
    .message.sent {
      background-color: #d1e7dd;
      align-self: flex-end;
    }
    .message.received {
      background-color: #e2e3e5;
      align-self: flex-start;
    }
  </style>
</head>
<body>

<div class="container">
  <h1 class="mt-4">Comunicación Directa</h1>
  <p>Contacta a tu tutor o estudiante para mantener una comunicación fluida antes y después de las sesiones.</p>

  <!-- Contenedor de chat -->
  <div class="chat-container">
    <!-- Lista de contactos -->
    <div class="contact-list">
      <div class="contact-item" onclick="cargarConversacion('Estudiante 1')">
        Estudiante 1 <span class="badge badge-pill badge-primary" id="notificacion-Estudiante 1">2</span>
      </div>
      <div class="contact-item" onclick="cargarConversacion('Estudiante 2')">
        Estudiante 2 <span class="badge badge-pill badge-primary" id="notificacion-Estudiante 2">1</span>
      </div>
      <!-- Agregar más contactos según sea necesario -->
    </div>

    <!-- Ventana de chat -->
    <div class="chat-window">
      <div class="messages" id="ventanaMensajes">
        <!-- Mensajes se mostrarán aquí -->
      </div>
      <div class="message-input">
        <input type="text" id="inputMensaje" placeholder="Escribe un mensaje..." />
        <button class="btn btn-primary" onclick="enviarMensaje()">Enviar</button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Script para gestionar el chat -->
<script>
  const conversaciones = {
    "Estudiante 1": [
      { tipo: "received", texto: "Hola, ¿cuándo es la próxima tutoría?" },
      { tipo: "sent", texto: "El lunes a las 10:00 AM." }
    ],
    "Estudiante 2": [
      { tipo: "received", texto: "¿Me puedes ayudar con el tema de física?" }
    ]
  };
  let contactoActivo = null;

  // Función para cargar la conversación con un contacto
  function cargarConversacion(contacto) {
    contactoActivo = contacto;
    document.getElementById('ventanaMensajes').innerHTML = '';
    document.querySelectorAll('.contact-item').forEach(item => item.classList.remove('active'));
    document.querySelector(`[onclick="cargarConversacion('${contacto}')"]`).classList.add('active');
    
    if (document.getElementById(`notificacion-${contacto}`)) {
      document.getElementById(`notificacion-${contacto}`).textContent = '';
    }

    conversaciones[contacto].forEach(mensaje => {
      mostrarMensaje(mensaje.texto, mensaje.tipo);
    });
  }

  // Función para mostrar un mensaje en la ventana de chat
  function mostrarMensaje(texto, tipo) {
    const mensajeElemento = document.createElement('div');
    mensajeElemento.classList.add('message', tipo);
    mensajeElemento.textContent = texto;
    document.getElementById('ventanaMensajes').appendChild(mensajeElemento);
    document.getElementById('ventanaMensajes').scrollTop = document.getElementById('ventanaMensajes').scrollHeight;
  }

  // Función para enviar un mensaje
  function enviarMensaje() {
    const texto = document.getElementById('inputMensaje').value;
    if (!texto || !contactoActivo) return;

    mostrarMensaje(texto, 'sent');
    conversaciones[contactoActivo].push({ tipo: 'sent', texto });
    document.getElementById('inputMensaje').value = '';
  }

  // Cargar la primera conversación al iniciar
  cargarConversacion('Estudiante 1');
</script>

</body>
</html>
<!--// API para obtener conversaciones de un usuario
app.get('/api/conversaciones/:usuarioId', (req, res) => {
  const usuarioId = req.params.usuarioId;
  // Consultar conversaciones en la base de datos
  res.json(conversaciones);
});

// WebSocket para mensajes en tiempo real
io.on('connection', socket => {
  socket.on('mensaje', data => {
    // Guardar mensaje en la base de datos y emitir al destinatario
    io.to(data.destinatarioId).emit('mensaje', data);
  });
});
-->
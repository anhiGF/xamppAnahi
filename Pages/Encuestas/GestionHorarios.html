<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestión de Horarios de Tutorías - ITS Jerez</title>
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
    }
    .main-content {
      margin-top: 20px;
    }
    .card {
      margin-bottom: 20px;
    }
    .calendar-table td, .calendar-table th {
      text-align: center;
      vertical-align: middle;
    }
    .available-block {
      background-color: #d4edda;
      color: #155724;
    }
    .unavailable-block {
      background-color: #f8d7da;
      color: #721c24;
    }
    .flexible-block {
      border: 2px dashed #007bff;
    }
  </style>
</head>
<body>

<div class="container">
  <h1 class="mt-4">Gestión de Horarios de Tutorías</h1>
  <p>Configura y gestiona tus horarios de tutorías de manera flexible y eficiente.</p>

  <!-- Formulario para configurar bloques de tiempo -->
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Agregar Bloque de Disponibilidad</h5>
      <form id="formBloqueTiempo">
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="fechaBloque">Fecha</label>
            <input type="date" class="form-control" id="fechaBloque" required>
          </div>
          <div class="form-group col-md-3">
            <label for="horaInicio">Hora de Inicio</label>
            <input type="time" class="form-control" id="horaInicio" required>
          </div>
          <div class="form-group col-md-3">
            <label for="horaFin">Hora de Fin</label>
            <input type="time" class="form-control" id="horaFin" required>
          </div>
        </div>
        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="bloqueFlexible">
          <label class="form-check-label" for="bloqueFlexible">Bloque Flexible</label>
        </div>
        <button type="submit" class="btn btn-primary mt-3">Agregar Bloque</button>
      </form>
    </div>
  </div>

  <!-- Vista de calendario semanal -->
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Agenda Semanal</h5>
      <table class="table table-bordered calendar-table">
        <thead>
          <tr>
            <th>Hora</th>
            <th>Lunes</th>
            <th>Martes</th>
            <th>Miércoles</th>
            <th>Jueves</th>
            <th>Viernes</th>
          </tr>
        </thead>
        <tbody id="tablaHorarios">
          <!-- Horarios de ejemplo (se actualizarán dinámicamente) -->
          <tr>
            <td>08:00 - 10:00</td>
            <td id="lunes-0800"></td>
            <td id="martes-0800"></td>
            <td id="miercoles-0800"></td>
            <td id="jueves-0800"></td>
            <td id="viernes-0800"></td>
          </tr>
          <!-- Añadir más filas según sea necesario -->
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Script para manejar los bloques de tiempo -->
<script>
  const horarios = {};

  // Función para agregar bloque de tiempo
  document.getElementById('formBloqueTiempo').addEventListener('submit', function(e) {
    e.preventDefault();

    const fecha = document.getElementById('fechaBloque').value;
    const horaInicio = document.getElementById('horaInicio').value;
    const horaFin = document.getElementById('horaFin').value;
    const flexible = document.getElementById('bloqueFlexible').checked;

    const diaSemana = new Date(fecha).getDay();
    const diaNombre = ['domingo', 'lunes', 'martes', 'miércoles', 'jueves', 'viernes', 'sábado'][diaSemana];
    const idBloque = `${diaNombre}-${horaInicio.replace(':', '')}`;

    const bloque = document.getElementById(idBloque);
    if (bloque) {
      bloque.textContent = `${horaInicio} - ${horaFin}`;
      bloque.classList.add('available-block');
      if (flexible) bloque.classList.add('flexible-block');
    } else {
      alert("El horario ingresado no está dentro de la vista semanal.");
    }

    // Guardar en horarios
    if (!horarios[diaNombre]) horarios[diaNombre] = [];
    horarios[diaNombre].push({ horaInicio, horaFin, flexible });
  });

  // Función para mostrar horarios en la tabla
  function mostrarHorarios() {
    for (const dia in horarios) {
      horarios[dia].forEach(bloque => {
        const idBloque = `${dia}-${bloque.horaInicio.replace(':', '')}`;
        const celda = document.getElementById(idBloque);
        if (celda) {
          celda.textContent = `${bloque.horaInicio} - ${bloque.horaFin}`;
          celda.classList.add('available-block');
          if (bloque.flexible) celda.classList.add('flexible-block');
        }
      });
    }
  }

  mostrarHorarios();
</script>

</body>
</html>

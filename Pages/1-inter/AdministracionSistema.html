<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Administración del Sistema - ITS Jerez</title>
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
    }
    .main-content {
      margin-top: 20px;
    }
  </style>
</head>
<body>

<div class="container">
  <h1 class="mt-4">Administración del Sistema</h1>
  <p>Gestiona usuarios, controla los permisos y monitoriza el uso de la plataforma.</p>

  <!-- Pestañas de navegación -->
  <ul class="nav nav-tabs" id="adminTab" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="usuarios-tab" data-toggle="tab" href="#usuarios" role="tab">Gestión de Usuarios</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="permisos-tab" data-toggle="tab" href="#permisos" role="tab">Control de Permisos</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="monitoreo-tab" data-toggle="tab" href="#monitoreo" role="tab">Monitorización del Sistema</a>
    </li>
  </ul>

  <div class="tab-content">
    <!-- Gestión de Usuarios -->
    <div class="tab-pane fade show active" id="usuarios" role="tabpanel">
      <div class="card my-4">
        <div class="card-body">
          <h5 class="card-title">Lista de Usuarios</h5>
          <button class="btn btn-primary mb-3" data-toggle="modal" data-target="#modalUsuario">Agregar Nuevo Usuario</button>

          <!-- Tabla de usuarios -->
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Email</th>
                <th>Rol</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="listaUsuarios">
              <!-- Aquí se cargarán dinámicamente los usuarios -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Control de Permisos -->
    <div class="tab-pane fade" id="permisos" role="tabpanel">
      <div class="card my-4">
        <div class="card-body">
          <h5 class="card-title">Control de Permisos por Rol</h5>

          <!-- Permisos por Rol -->
          <form id="formPermisos">
            <div class="form-group">
              <label for="rolSeleccionado">Seleccionar Rol</label>
              <select class="form-control" id="rolSeleccionado">
                <option value="Administrador">Administrador</option>
                <option value="Tutor">Tutor</option>
                <option value="Estudiante">Estudiante</option>
              </select>
            </div>
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="permiso1">
              <label class="form-check-label" for="permiso1">Acceso a gestión de tutorías</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="permiso2">
              <label class="form-check-label" for="permiso2">Acceso a reportes</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="permiso3">
              <label class="form-check-label" for="permiso3">Acceso a evaluaciones</label>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Guardar Permisos</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Monitorización del Sistema -->
    <div class="tab-pane fade" id="monitoreo" role="tabpanel">
      <div class="card my-4">
        <div class="card-body">
          <h5 class="card-title">Estado del Sistema</h5>

          <div class="row">
            <div class="col-md-4">
              <div class="alert alert-info">
                <strong>Usuarios Totales:</strong> <span id="usuariosTotales">0</span>
              </div>
            </div>
            <div class="col-md-4">
              <div class="alert alert-info">
                <strong>Tutorías Programadas:</strong> <span id="tutoriasTotales">0</span>
              </div>
            </div>
            <div class="col-md-4">
              <div class="alert alert-info">
                <strong>Usuarios Activos Hoy:</strong> <span id="usuariosActivos">0</span>
              </div>
            </div>
          </div>

          <!-- Gráfico de uso de la plataforma -->
          <canvas id="graficoMonitoreo" width="400" height="200"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal para agregar/editar usuarios -->
<div class="modal fade" id="modalUsuario" tabindex="-1" role="dialog" aria-labelledby="modalUsuarioLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalUsuarioLabel">Agregar/Editar Usuario</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formUsuario">
          <div class="form-group">
            <label for="nombreUsuario">Nombre</label>
            <input type="text" class="form-control" id="nombreUsuario" required>
          </div>
          <div class="form-group">
            <label for="emailUsuario">Email</label>
            <input type="email" class="form-control" id="emailUsuario" required>
          </div>
          <div class="form-group">
            <label for="rolUsuario">Rol</label>
            <select class="form-control" id="rolUsuario">
              <option value="Administrador">Administrador</option>
              <option value="Tutor">Tutor</option>
              <option value="Estudiante">Estudiante</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Guardar Usuario</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Chart.js para el monitoreo del sistema -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // Simulación de usuarios y tutorías
  let usuarios = [
    { nombre: 'Juan Pérez', email: 'juanperez@example.com', rol: 'Estudiante' },
    { nombre: 'Laura López', email: 'lauralopez@example.com', rol: 'Tutor' },
    { nombre: 'Carlos Martínez', email: 'carlosmartinez@example.com', rol: 'Administrador' }
  ];

  let tutoriasTotales = 20;
  let usuariosActivosHoy = 5;

  // Función para mostrar los usuarios en la tabla
  function mostrarUsuarios() {
    const listaUsuarios = document.getElementById('listaUsuarios');
    listaUsuarios.innerHTML = ''; // Limpiar la tabla

    usuarios.forEach(usuario => {
      const fila = document.createElement('tr');
      fila.innerHTML = `
        <td>${usuario.nombre}</td>
        <td>${usuario.email}</td>
        <td>${usuario.rol}</td>
        <td>
          <button class="btn btn-warning btn-sm" onclick="editarUsuario('${usuario.email}')">Editar</button>
          <button class="btn btn-danger btn-sm" onclick="eliminarUsuario('${usuario.email}')">Eliminar</button>
        </td>
      `;
      listaUsuarios.appendChild(fila);
    });

    document.getElementById('usuariosTotales').textContent = usuarios.length;
  }

  // Función para agregar un nuevo usuario
  document.getElementById('formUsuario').addEventListener('submit', function(e) {
    e.preventDefault();

    const nuevoUsuario = {
      nombre: document.getElementById('nombreUsuario').value,
      email: document.getElementById('emailUsuario').value,
      rol: document.getElementById('rolUsuario').value
    };

    usuarios.push(nuevoUsuario);
    mostrarUsuarios();
    $('#modalUsuario').modal('hide'); // Cerrar el modal
  });

  // Función para eliminar un usuario
  function eliminarUsuario(email) {
    usuarios = usuarios.filter(usuario => usuario.email !== email);
    mostrarUsuarios();
  }

  // Función para editar un usuario
  function editarUsuario(email) {
    const usuario = usuarios.find(u => u.email === email);
    if (usuario) {
      document.getElementById('nombreUsuario').value = usuario.nombre;
      document.getElementById('emailUsuario').value = usuario.email;
      document.getElementById('rolUsuario').value = usuario.rol;

      eliminarUsuario(email); // Eliminar el usuario antes de actualizar
    }
    $('#modalUsuario').modal('show');
  }

  // Cargar usuarios y estadísticas cuando se carga la página
  mostrarUsuarios();
  document.getElementById('tutoriasTotales').textContent = tutoriasTotales;
  document.getElementById('usuariosActivos').textContent = usuariosActivosHoy;

  // Gráfico de monitorización
  const ctx = document.getElementById('graficoMonitoreo').getContext('2d');
  const graficoMonitoreo = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio'],
      datasets: [{
        label: 'Sesiones de Tutoría por Mes',
        data: [12, 19, 3, 5, 2, 3],
        backgroundColor: 'rgba(54, 162, 235, 0.2)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>

</body>
</html>
